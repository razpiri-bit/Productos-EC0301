<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>¬°Pago Exitoso! - SkillsCert</title>
  <style>
    :root {
      --success: #10B981;
      --primary: #1E3A8A;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .success-card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 600px;
      width: 100%;
      padding: 3rem 2.5rem;
      text-align: center;
    }
    .success-icon {
      width: 120px;
      height: 120px;
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 2rem;
      animation: scaleIn 0.5s ease-out;
    }
    .success-icon span {
      font-size: 4rem;
    }
    @keyframes scaleIn {
      from {
        transform: scale(0);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
    h1 {
      color: var(--primary);
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .subtitle {
      color: #6B7280;
      font-size: 1.1rem;
      margin-bottom: 2rem;
    }
    .info-box {
      background: #F9FAFB;
      padding: 1.5rem;
      border-radius: 12px;
      margin: 2rem 0;
      text-align: left;
    }
    .info-box h3 {
      color: var(--primary);
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    .info-item {
      display: flex;
      align-items: start;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #E5E7EB;
    }
    .info-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .info-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
    }
    .info-content {
      flex: 1;
    }
    .info-title {
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 0.25rem;
    }
    .info-desc {
      font-size: 0.9rem;
      color: #6B7280;
    }
    .btn-primary {
      display: inline-block;
      padding: 1rem 2.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-decoration: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s;
      margin-top: 1.5rem;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    .session-info {
      background: #FEF3C7;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 2rem;
      font-size: 0.85rem;
      color: #92400E;
    }
    .loading {
      text-align: center;
      color: #6B7280;
      padding: 2rem;
    }
    .spinner {
      display: inline-block;
      width: 2rem;
      height: 2rem;
      border: 3px solid rgba(0,0,0,0.1);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="success-card">
    <div id="content" class="loading">
      <div class="spinner"></div>
      <p style="margin-top: 1rem;">Verificando tu pago...</p>
    </div>
  </div>

  <script>
    async function verificarPago() {
      const urlParams = new URLSearchParams(window.location.search);
      const sessionId = urlParams.get('session_id');

      if (!sessionId) {
        mostrarError();
        return;
      }

      try {
        const response = await fetch(`/api/checkout-session?session_id=${sessionId}`);
        const session = await response.json();

        if (session.payment_status === 'paid') {
          mostrarExito(session);
        } else {
          mostrarError();
        }
      } catch (error) {
        console.error('Error:', error);
        mostrarError();
      }
    }

    function mostrarExito(session) {
      const deliveryMethod = session.metadata?.delivery_method || 'email';
      const email = session.customer_details?.email || session.metadata?.email;
      const telefono = session.customer_details?.phone || session.metadata?.telefono;
      
      let deliveryText = '';
      if (deliveryMethod === 'email') {
        deliveryText = `üìß <strong>Por Email</strong><br>${email}`;
      } else if (deliveryMethod === 'whatsapp') {
        deliveryText = `üì± <strong>Por WhatsApp</strong><br>${telefono}`;
      } else {
        deliveryText = `üìß <strong>Email:</strong> ${email}<br>üì± <strong>WhatsApp:</strong> ${telefono}`;
      }

      document.getElementById('content').innerHTML = `
        <div class="success-icon">
          <span>‚úì</span>
        </div>
        
        <h1>¬°Pago Exitoso!</h1>
        <p class="subtitle">Tu c√≥digo de acceso est√° en camino</p>

        <div class="info-box">
          <h3>üì¨ Recibir√°s tu c√≥digo por:</h3>
          <p style="text-align: center; font-size: 1.1rem; color: var(--primary); margin: 1rem 0;">
            ${deliveryText}
          </p>
        </div>

        <div class="info-box">
          <h3>üöÄ Pr√≥ximos Pasos</h3>
          
          <div class="info-item">
            <span class="info-icon">üì®</span>
            <div class="info-content">
              <div class="info-title">1. Revisa tu ${deliveryMethod === 'email' ? 'email' : deliveryMethod === 'whatsapp' ? 'WhatsApp' : 'email y WhatsApp'}</div>
              <div class="info-desc">Deber√≠as recibir tu c√≥digo en los pr√≥ximos minutos</div>
            </div>
          </div>

          <div class="info-item">
            <span class="info-icon">üîê</span>
            <div class="info-content">
              <div class="info-title">2. Guarda tu c√≥digo</div>
              <div class="info-desc">Es personal e intransferible. V√°lido por 365 d√≠as</div>
            </div>
          </div>

          <div class="info-item">
            <span class="info-icon">üéì</span>
            <div class="info-content">
              <div class="info-title">3. Ingresa a la plataforma</div>
              <div class="info-desc">Usa tu email y c√≥digo para acceder</div>
            </div>
          </div>
        </div>

        <a href="/login.html" class="btn-primary">
          üöÄ Ingresar a la Plataforma
        </a>

        <div class="session-info">
          <strong>üìã Informaci√≥n de tu compra:</strong><br>
          N√∫mero de sesi√≥n: ${session.id}<br>
          Monto: $${(session.amount_total / 100).toFixed(2)} ${session.currency.toUpperCase()}
        </div>

        <p style="margin-top: 2rem; color: #6B7280; font-size: 0.9rem;">
          ¬øNo recibiste tu c√≥digo?<br>
          Revisa tu carpeta de spam o contacta a 
          <a href="mailto:info@skillscert.com.mx" style="color: var(--primary);">info@skillscert.com.mx</a>
        </p>
      `;
    }

    function mostrarError() {
      document.getElementById('content').innerHTML = `
        <div class="success-icon" style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);">
          <span>‚úï</span>
        </div>
        
        <h1 style="color: #DC2626;">Algo sali√≥ mal</h1>
        <p class="subtitle">No pudimos verificar tu pago</p>

        <div class="info-box">
          <p style="color: #6B7280;">
            Si realizaste el pago y llegaste a esta p√°gina, es posible que:<br>
            ‚Ä¢ El pago a√∫n est√° proces√°ndose<br>
            ‚Ä¢ Hubo un error temporal<br>
            ‚Ä¢ La sesi√≥n expir√≥
          </p>
        </div>

        <p style="margin-top: 1.5rem;">
          <a href="/checkout.html" class="btn-primary" style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);">
            Intentar de Nuevo
          </a>
        </p>

        <p style="margin-top: 2rem; color: #6B7280; font-size: 0.9rem;">
          ¬øNecesitas ayuda?<br>
          Contacta a <a href="mailto:info@skillscert.com.mx" style="color: var(--primary);">info@skillscert.com.mx</a>
        </p>
      `;
    }

    // Verificar pago al cargar la p√°gina
    verificarPago();
  </script>
</body>
</html>
