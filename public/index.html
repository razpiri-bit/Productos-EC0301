<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SkillsCert - Generador EC0301</title>
  <script src="https://js.stripe.com/v3/"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem 1rem;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      color: white;
      margin-bottom: 3rem;
    }
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    .header p {
      font-size: 1.2rem;
      opacity: 0.9;
    }
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .feature-card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding: 1.5rem;
      border-radius: 15px;
      color: white;
    }
    .feature-card h3 {
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    .payment-section {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 2.5rem;
      max-width: 600px;
      margin: 0 auto;
    }
    .payment-section h2 {
      color: #1F2937;
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .price-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem;
      border-radius: 15px;
      text-align: center;
      margin-bottom: 2rem;
    }
    .price-box .price {
      font-size: 3rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .price-box .period {
      font-size: 1.2rem;
      opacity: 0.9;
    }
    .form-group {
      margin-bottom: 1.5rem;
    }
    .form-group label {
      display: block;
      font-weight: 600;
      color: #1F2937;
      margin-bottom: 0.5rem;
    }
    .form-group input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid #E5E7EB;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s;
    }
    .form-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .payment-methods {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 2rem;
    }
    .payment-btn {
      padding: 1rem;
      border: 2px solid #E5E7EB;
      border-radius: 10px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }
    .payment-btn:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }
    .payment-btn .icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    .payment-btn .title {
      font-weight: 600;
      color: #1F2937;
      margin-bottom: 0.25rem;
    }
    .payment-btn .subtitle {
      font-size: 0.85rem;
      color: #6B7280;
    }
    .help-text {
      text-align: center;
      margin-top: 1.5rem;
      color: #6B7280;
      font-size: 0.9rem;
    }
    .help-text a {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
    }
    @media (max-width: 640px) {
      .payment-methods {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéì SkillsCert</h1>
      <p>Genera tus Documentos <strong>EC0301</strong> en minutos</p>
    </div>

    <div class="features">
      <div class="feature-card">
        <h3>‚úÖ Asistente IA para objetivos.</h3>
        <p>Genera objetivos de aprendizaje autom√°ticamente</p>
      </div>
      <div class="feature-card">
        <h3>üìã Generaci√≥n autom√°tica de formatos.</h3>
        <p>Carta descriptiva, plan de evaluaci√≥n y m√°s</p>
      </div>
      <div class="feature-card">
        <h3>üë• Exportaci√≥n a PDF y Word.</h3>
        <p>Descarga tus documentos en el formato que prefieras</p>
      </div>
      <div class="feature-card">
        <h3>üõ°Ô∏è 100% alineado al est√°ndar.</h3>
        <p>Cumple con todos los requisitos EC0301</p>
      </div>
    </div>

    <div class="payment-section">
      <h2>Obt√©n 3 meses de acceso ilimitado</h2>

      <div class="price-box">
        <div class="price">$999 MXN</div>
        <div class="period">Acceso por 90 d√≠as</div>
      </div>

      <form id="paymentForm">
        <div class="form-group">
          <label for="name">Nombre completo</label>
          <input 
            type="text" 
            id="name" 
            name="name" 
            placeholder="ROBERTO AZPIRI GARCIA"
            required
          />
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            placeholder="tu@email.com"
            required
          />
        </div>

        <div class="form-group">
          <label for="phone">Tel√©fono (opcional)</label>
          <input 
            type="tel" 
            id="phone" 
            name="phone" 
            placeholder="5538822334"
          />
        </div>

        <h3 style="margin-bottom: 1rem; color: #1F2937;">Elige tu m√©todo de pago</h3>

        <div class="payment-methods">
          <button type="button" class="payment-btn" onclick="pagarConTarjeta()">
            <div class="icon">üí≥</div>
            <div class="title">Pagar con Tarjeta / OXXO</div>
            <div class="subtitle">(Autom√°tico v√≠a Stripe)</div>
          </button>

          <button type="button" class="payment-btn" onclick="pagarConTransferencia()">
            <div class="icon">üè¶</div>
            <div class="title">Pagar con Transferencia</div>
            <div class="subtitle">(Verificaci√≥n manual)</div>
          </button>
        </div>
      </form>

      <div class="help-text">
        <p>¬øYa tienes un c√≥digo de acceso? <a href="/login.html">Ingresa aqu√≠</a></p>
      </div>
    </div>
  </div>

  <script>
    // ‚öôÔ∏è CONFIGURACI√ìN DE STRIPE
    // ‚ö†Ô∏è IMPORTANTE: Reemplaza con tu STRIPE_PUBLISHABLE_KEY
    const STRIPE_PUBLISHABLE_KEY = 'pk_test_51QJy6JBJM4WhUPGtzOk0H3ZdP4B4oKZZOwUDPWThtfKvMRvRKm2AJLxNQ56xhzaKrIIa6oN9OPLWBibqxVkA4z7w00gJ77nkz7';
    
    // ‚ö†Ô∏è IMPORTANTE: Reemplaza con tu PRICE_ID de Stripe
    const STRIPE_PRICE_ID = 'price_1QJy7mBJM4WhUPGtf5oRjmCd'; // Tu Price ID real de MXN 999
    
    const stripe = Stripe(STRIPE_PUBLISHABLE_KEY);

    // Funci√≥n para validar formulario
    function validarFormulario() {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();

      if (!name || !email) {
        Swal.fire({
          icon: 'warning',
          title: 'Campos incompletos',
          text: 'Por favor completa tu nombre y email'
        });
        return false;
      }

      if (!email.includes('@')) {
        Swal.fire({
          icon: 'error',
          title: 'Email inv√°lido',
          text: 'Por favor ingresa un email v√°lido'
        });
        return false;
      }

      return true;
    }

    // Pagar con Tarjeta (Stripe)
    async function pagarConTarjeta() {
      if (!validarFormulario()) return;

      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();

      // Mostrar loading
      Swal.fire({
        title: 'Procesando...',
        text: 'Redirigiendo a la p√°gina de pago',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      try {
        // ‚úÖ CORRECCI√ìN: Enviar priceId correctamente
        const response = await fetch('/create-checkout-session', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            priceId: STRIPE_PRICE_ID,  // ‚úÖ ESTO ES LO IMPORTANTE
            email: email,
            phone: phone
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Error al crear sesi√≥n de pago');
        }

        // Redirigir a Stripe Checkout
        const result = await stripe.redirectToCheckout({
          sessionId: data.sessionId
        });

        if (result.error) {
          throw new Error(result.error.message);
        }

      } catch (error) {
        console.error('Error:', error);
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: error.message || 'No se pudo procesar el pago. Intenta de nuevo.',
          footer: 'Si el problema persiste, contacta a info@skillscert.com.mx'
        });
      }
    }

    // Pagar con Transferencia
    function pagarConTransferencia() {
      if (!validarFormulario()) return;

      Swal.fire({
        icon: 'info',
        title: 'Pago por Transferencia',
        html: `
          <div style="text-align: left; padding: 1rem;">
            <h3 style="margin-bottom: 1rem;">üìã Datos bancarios:</h3>
            <p><strong>Banco:</strong> BBVA</p>
            <p><strong>Cuenta:</strong> 0123456789</p>
            <p><strong>CLABE:</strong> 012345678901234567</p>
            <p><strong>Beneficiario:</strong> SkillsCert M√©xico</p>
            <p><strong>Monto:</strong> $999.00 MXN</p>
            <hr style="margin: 1rem 0;">
            <p style="color: #666; font-size: 0.9rem;">
              ‚ö†Ô∏è Despu√©s de realizar tu transferencia, env√≠a tu comprobante a 
              <strong>info@skillscert.com.mx</strong> con tu email y recibir√°s 
              tu c√≥digo de acceso en 24 horas.
            </p>
          </div>
        `,
        confirmButtonText: 'Entendido',
        width: '600px'
      });
    }
  </script>
</body>
</html>
